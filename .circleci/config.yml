version: 2.1
orbs:
  ci: bigcommerce/internal@volatile
  microapp: bigcommerce/internal-microapp@volatile

default_params: &default_params
  context: GCR + Artifact Bucket Access
  node_version: '14.21'

workflows:
  version: 2
  ci-checks:
    jobs:
      - microapp/lint:
          <<: *default_params
      - microapp/test:
          <<: *default_params
      - microapp/build:
          <<: *default_params
      - ci/validate-commits

      - microapp/upload-artifact:
          context: GCR + Artifact Bucket Access
          requires:
            - microapp/lint
            - microapp/test
            - microapp/build

      - ci/notify-success:
          context: GCR + Artifact Bucket Access
          requires:
            - ci/validate-commits
            - microapp/upload-artifact
